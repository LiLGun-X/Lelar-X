#!/bin/bash
# ==================================
# ModuX Installer
# Author: gunx
# ==================================

set -e

# ===== CONFIG =====
GITHUB_REPO="https://github.com/LiLGun-X/Lelar-X"
INSTALL_DIR="/bin"
MODUX_DIR="/bin/modux"
TMP_DIR="/tmp/modux_install"

# ===== CHECK ROOT =====
if [ "$EUID" -ne 0 ]; then
  echo "‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏±‡∏ô‡∏î‡πâ‡∏ß‡∏¢ root (sudo)"
  exit 1
fi

echo "üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á ModuX..."

# ===== CLEAN TMP =====
rm -rf "$TMP_DIR"
mkdir -p "$TMP_DIR"

# ===== CLONE REPO =====
echo "üì• ‡∏î‡∏∂‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏≤‡∏Å GitHub..."
git clone "$GITHUB_REPO" "$TMP_DIR"

# ===== CHECK MODUX =====
if [ ! -d "$TMP_DIR/modux" ]; then
  echo "‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå modux ‡πÉ‡∏ô repo"
  exit 1
fi

# ===== INSTALL MODUX =====
echo "üìÇ ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà $MODUX_DIR"
rm -rf "$MODUX_DIR"
cp -r "$TMP_DIR/modux" "$MODUX_DIR"

# ===== PERMISSION =====
echo "üîë ‡∏ï‡∏±‡πâ‡∏á permission..."
chmod -R 755 "$MODUX_DIR"

# menux ‡∏ï‡πâ‡∏≠‡∏á executable
chmod +x "$MODUX_DIR/menux"

# ===== CREATE SYMLINK =====
echo "üîó ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á menux"
ln -sf "$MODUX_DIR/menux" /bin/menux

# ===== CLEAN =====
rm -rf "$TMP_DIR"

echo "‚úÖ ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!"
echo "üëâ ‡∏û‡∏¥‡∏°‡∏û‡πå menux ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô"
# ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞ modux
cp -r /tmp/scriptx/$SUBDIR/* $INSTALL_DIR/

# ‡πÉ‡∏´‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏£‡∏±‡∏ô
chmod +x $INSTALL_DIR/*

# ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á menux
ln -sf $INSTALL_DIR/menux /bin/menux

echo "‚úÖ ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"
echo "üëâ ‡∏û‡∏¥‡∏°‡∏û‡πå menux ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô"
